# Default values for openclaw.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# -- Number of replicas for the OpenClaw gateway
# Note: Typically should be 1 as OpenClaw maintains state
replicaCount: 1

# -- Docker image configuration
image:
  # -- Image repository (CN-IM image with Feishu/DingTalk/QQ/WeCom support)
  repository: ghcr.io/jesset/openclaw-k8s
  # -- Image pull policy
  pullPolicy: IfNotPresent
  # -- Image tag (defaults to chart appVersion if not set)
  tag: "main"

# -- Image pull secrets for private registries (required for ghcr.io private images)
imagePullSecrets: []

# -- String to override the default name
nameOverride: ""

# -- String to override the default fullname
fullnameOverride: ""

# -- Service account configuration
serviceAccount:
  # -- Specifies whether a service account should be created
  create: true
  # -- Automount service account token
  automountServiceAccountToken: false
  # -- Annotations to add to the service account
  annotations: {}
  # -- The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

# -- Pod annotations
podAnnotations: {}

# -- Pod security context
podSecurityContext:
  fsGroup: 1000
  runAsNonRoot: true
  seccompProfile:
    type: RuntimeDefault

# -- Container security context
# Note: CN-IM image needs writable filesystem for Chromium cache and plugin runtime
securityContext:
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false
  runAsNonRoot: true
  runAsUser: 1000
  allowPrivilegeEscalation: false
  seccompProfile:
    type: RuntimeDefault

# -- Service configuration
service:
  # -- Service type
  type: ClusterIP
  # -- Service port
  port: 18789
  # -- Target port on the container
  targetPort: 18789
  # -- NodePort (only used when service.type is NodePort)
  nodePort: null
  # -- Service annotations
  annotations: {}
  # -- Enable bridge port for CN-IM channels
  bridgeEnabled: false
  # -- Bridge service port
  bridgePort: 18790
  # -- Bridge target port on the container
  bridgeTargetPort: 18790

# -- Ingress configuration
ingress:
  # -- Enable ingress
  enabled: false
  # -- Ingress class name
  className: ""
  # -- Additional annotations for the ingress
  # WebSocket support annotations for common ingress controllers
  annotations:
    # nginx ingress controller
    nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
    nginx.ingress.kubernetes.io/proxy-http-version: "1.1"
    nginx.ingress.kubernetes.io/proxy-buffering: "off"
    # Enable WebSocket upgrade
    nginx.ingress.kubernetes.io/configuration-snippet: |
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
  # -- Ingress hosts
  hosts:
    - host: openclaw.local
      paths:
        - path: /
          pathType: ImplementationSpecific
  # -- TLS configuration
  tls: []
  #  - secretName: openclaw-tls
  #    hosts:
  #      - openclaw.local

# -- Resource requests and limits
resources:
  # -- Resource limits
  limits:
    cpu: 2000m
    memory: 8Gi
  # -- Resource requests
  requests:
    cpu: 250m
    memory: 1Gi

# -- Horizontal Pod Autoscaler configuration
autoscaling:
  # -- Enable HPA
  enabled: false
  # -- Minimum number of replicas
  minReplicas: 1
  # -- Maximum number of replicas
  # Note: OpenClaw is single-instance, must be 1 when autoscaling is enabled
  maxReplicas: 1
  # -- Target CPU utilization percentage
  targetCPUUtilizationPercentage: 80
  # -- Target memory utilization percentage
  targetMemoryUtilizationPercentage: 80
  # -- Custom metrics for HPA
  metrics: []
  # -- Scaling behavior configuration
  behavior: {}

# -- Node selector
nodeSelector: {}

# -- Tolerations for pod scheduling
tolerations: []

# -- Affinity rules for pod scheduling
affinity: {}

# -- Pod topology spread constraints
topologySpreadConstraints: []

# -- Extra environment variables
extraEnv: []
  # - name: EXTRA_VAR
  #   value: "extra-value"

# -- Extra environment variables from secrets/configmaps
extraEnvFrom: []
  # - secretRef:
  #     name: my-secret

# -- Extra volume mounts for the container
extraVolumeMounts: []
  # - name: extra-volume
  #   mountPath: /extra

# -- Extra volumes for the pod
extraVolumes: []
  # - name: extra-volume
  #   persistentVolumeClaim:
  #     claimName: extra-pvc

# -- Init containers
initContainers: []

# -- Sidecar containers
sidecars: []

# -- Persistent Volume configuration
persistence:
  # -- Enable persistent storage
  enabled: true
  # -- Persistence type: "pvc" or "hostPath"
  # pvc: Use PersistentVolumeClaim (recommended for production)
  # hostPath: Use host directory (useful for single-node clusters or development)
  type: pvc
  # -- Storage class name (empty for default, only used when type=pvc)
  storageClass: ""
  # -- Access mode for the PVC (only used when type=pvc)
  accessMode: ReadWriteOnce
  # -- Size of the persistent volume (only used when type=pvc)
  size: 10Gi
  # -- Existing PVC to use (if set, StatefulSet will use this instead of creating new PVCs)
  # Only used when type=pvc
  existingClaim: ""
  # -- Annotations for the PVC (only used when type=pvc)
  annotations: {}
  # -- Retain policy for the PVC (only used when type=pvc)
  retainPolicy: Retain
  # -- Use StatefulSet volumeClaimTemplates (default: true, only used when type=pvc)
  # When true, StatefulSet manages PVC creation via volumeClaimTemplates
  # When false, a separate PVC is created and referenced by StatefulSet
  useStatefulSetVolumeClaim: true
  # -- Host path for data storage (only used when type=hostPath)
  # WARNING: Data will be stored on the node's filesystem. Ensure the path exists and has correct permissions.
  # The directory should be owned by UID 1000 (node user)
  hostPath: /data/openclaw

# -- OpenClaw configuration (rendered as openclaw.json via ConfigMap)
openclaw:
  # -- Force reseed config from ConfigMap on next restart (deletes existing config in PVC)
  # WARNING: This will overwrite any runtime changes made through the OpenClaw UI
  # Set to true, run helm upgrade, then set back to false
  forceReseedConfig: false
  config:
    meta:
      lastTouchedVersion: "2026.1.29"
    update:
      checkOnStart: false
    browser:
      headless: true
      noSandbox: true
      defaultProfile: "openclaw"
      executablePath: "/usr/bin/chromium"
    models:
      mode: "merge"
      providers: {}
      # Example:
      # default:
      #   baseUrl: "https://api.openai.com/v1"
      #   apiKey: "your-api-key"
      #   api: "openai-completions"
      #   models:
      #     - id: "gpt-4o"
      #       name: "GPT-4o"
      #       reasoning: false
      #       input: ["text", "image"]
      #       contextWindow: 128000
      #       maxTokens: 4096
    agents:
      defaults:
        workspace: "/home/node/.openclaw/workspace"
        compaction:
          mode: "safeguard"
        elevatedDefault: "full"
        maxConcurrent: 4
        subagents:
          maxConcurrent: 8
    messages:
      ackReactionScope: "group-mentions"
      tts:
        edge:
          voice: "zh-CN-XiaoxiaoNeural"
    commands:
      native: "auto"
      nativeSkills: "auto"
    channels: {}
    # Example - Feishu:
    #   feishu:
    #     enabled: true
    #     connectionMode: "websocket"
    #     dmPolicy: "pairing"
    #     groupPolicy: "allowlist"
    #     requireMention: true
    #     appId: "your-app-id"
    #     appSecret: "your-app-secret"
    # Example - DingTalk:
    #   dingtalk:
    #     enabled: true
    #     clientId: "dingxxxxxx"
    #     clientSecret: "your-secret"
    #     robotCode: "dingxxxxxx"
    #     corpId: "dingxxxxxx"
    #     agentId: "123456789"
    #     dmPolicy: "open"
    #     groupPolicy: "open"
    #     messageType: "markdown"
    gateway:
      port: 18789
      mode: "local"
      bind: "lan"
      controlUi:
        allowInsecureAuth: true
    plugins:
      entries: {}
      installs: {}
    logging:
      level: "info"

# -- Secrets configuration
secrets:
  # -- Use existing secret instead of creating one
  existingSecret: ""
  # -- Secret annotations
  annotations: {}
  # -- API Keys
  anthropicApiKey: ""
  openaiApiKey: ""
  # -- Messaging channel tokens (international)
  discordBotToken: ""
  telegramBotToken: ""
  slackBotToken: ""
  slackAppToken: ""
  # -- Gateway authentication token
  openclawGatewayToken: ""
  # -- Feishu (飞书)
  feishuAppId: ""
  feishuAppSecret: ""
  # -- DingTalk (钉钉)
  dingtalkClientId: ""
  dingtalkClientSecret: ""
  dingtalkRobotCode: ""
  dingtalkCorpId: ""
  dingtalkAgentId: ""
  # -- QQ Bot (QQ 机器人)
  qqbotAppId: ""
  qqbotClientSecret: ""
  # -- WeCom (企业微信)
  wecomToken: ""
  wecomEncodingAesKey: ""

# -- Liveness probe configuration
livenessProbe:
  enabled: true
  exec:
    command:
      - openclaw
      - health
  initialDelaySeconds: 30
  periodSeconds: 30
  timeoutSeconds: 20
  failureThreshold: 5
  successThreshold: 1

# -- Readiness probe configuration
readinessProbe:
  enabled: true
  exec:
    command:
      - openclaw
      - health
  initialDelaySeconds: 30
  periodSeconds: 30
  timeoutSeconds: 20
  failureThreshold: 5
  successThreshold: 1

# -- Startup probe configuration
startupProbe:
  enabled: false
  exec:
    command:
      - openclaw
      - health
  initialDelaySeconds: 30
  periodSeconds: 30
  timeoutSeconds: 20
  failureThreshold: 5
  successThreshold: 1

# -- Pod Disruption Budget configuration
podDisruptionBudget:
  # -- Enable Pod Disruption Budget
  enabled: false
  # -- Minimum available pods (number or percentage)
  minAvailable: 1
  # -- Maximum unavailable pods (number or percentage)
  # maxUnavailable: 1
